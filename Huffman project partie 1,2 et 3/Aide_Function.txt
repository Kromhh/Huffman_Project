//4ème : l'encodage

void fonction_encod(node *Htree)
{
    // Initialization of input file
    FILE *input=NULL;

    FILE *huffman=NULL;

    FILE *dico=NULL;

    input=fopen("Text.txt","r");

    dico=fopen("Dico.txt","r");
    huffman=fopen("dico_huffman.txt","w+");

    if(input!=NULL && huffman!=NULL && dico!=NULL)
    {
        char character=fgetc(input);

        while(character!=EOF)
        {
            // Writing binary code if the character is \n
            if(character=='\n') {
                    research_dico_n(&huffman,dico);
            }

            // Writing binary code for other character
            else research_dico(character,&huffman,dico);

            // we go to the next character
            character=fgetc(input);
        }
    }
        // Closing all files

    fclose(input);

    fclose(huffman);

    fclose(dico);
}

void research_dico_n(FILE **huffman, FILE *dico)
{
    // respond to line stocked in the string
    char tab_code[1000];

    // Index of tab code
    int i;

    // is placed at the very beginning of the text in case
    rewind(dico);


    // storage each line in data_line at each turn of the loop
    while(fgets(tab_code,1000,dico)!=NULL)
    {
        // The case of the line break corresponds to this one (:010010) for us
        if(tab_code[0]==':' && tab_code[1]!=':')
        {
            for(i=0;tab_code[i]!='\0';i++)
            {
                // Writing binary code in the Huffman file only if there are just '0' or '1'
                if(tab_code[i]== '0' || tab_code[i]== '1')
                    fprintf(*huffman,"%c",tab_code[i]);
            }
         }
    }
}

void research_dico(char character,FILE **huffman, FILE *dico)
{


    char tab_bin[1000];

    // Index of data_line
    int i;


    rewind(dico);

    while(fgets(tab_bin,1000,dico)!=NULL)
    {

        if(tab_bin[0]==character)
        {
            for(i=0;tab_bin[i]!='\n';i++)
            {
                // Writing binary code in the Huffman file only if there are just '0' or '1'
                if(tab_bin[i]== '0' || tab_bin[i]== '1')
                    fprintf(*huffman,"%c",tab_bin[i]);
            }
        }
    }

}

//5ème : le decodage

void decoding(node *tree)
{
    if(tree!=NULL)
    {

        node *temp=tree;


        FILE *decod=NULL;


        FILE *huffman=NULL;

        decod=fopen("decodage.txt","w+");

        // Opening huffman file in only lecture
        huffman=fopen("dico_huffman.txt","r");


        if(huffman!=NULL && decod!=NULL)
        {

            char character=fgetc(huffman);
            while(character!=EOF)
            {
                if(character=='0')
                    temp=temp->left;
                else if(character=='1')
                    temp=temp->right;

                if(temp->left==NULL && temp->right==NULL)
                {
                    //writting in the file
                    fprintf(decod,"%c",temp->data->letter);

                    temp=tree;
                }

                                                   // we go to the next character
                character=fgetc(huffman);
            }

        }

        // Closing all files
        fclose(decod);

        fclose(huffman);
    }
}
